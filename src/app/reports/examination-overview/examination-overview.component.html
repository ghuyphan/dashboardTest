<div class="page-container">
  <div class="page-content">
    
    <div class="filter-section">
      <div class="filter-group">
        <label for="fromDate">Từ ngày:</label>
        <input type="date" id="fromDate" [(ngModel)]="fromDate" class="form-control-sm">
      </div>
      <div class="filter-group">
        <label for="toDate">Đến ngày:</label>
        <input type="date" id="toDate" [(ngModel)]="toDate" class="form-control-sm">
      </div>
      <button class="btn btn-primary" (click)="loadData()" [disabled]="isLoading">
        @if (isLoading) {
          <i class="fas fa-spinner fa-spin"></i>
        } @else {
          <i class="fas fa-search"></i>
        }
        Xem báo cáo
      </button>
    </div>

    <div class="widget-section">
      <div class="widget-grid">
        @if (isLoading && widgetData.length === 0) {
           @for (i of [1, 2, 3, 4]; track i) {
            <app-widget-card [title]="'Loading'" [isLoading]="true"></app-widget-card>
          }
        } @else {
           @for (widget of widgetData; track trackByWidget($index, widget)) {
            <app-widget-card
              [icon]="widget.icon"
              [title]="widget.title"
              [value]="widget.value"
              [caption]="widget.caption"
              [accentColor]="widget.accentColor"
              [isLoading]="isLoading">
            </app-widget-card>
          }
        }
      </div>
    </div>

    <div class="dashboard-grid">
      <app-chart-card class="span-full"
        title="Biểu đồ Tiếp nhận theo Ngày"
        icon="fas fa-chart-line"
        [isLoading]="isLoading"
        iconClass="icon-info"
        [chartOptions]="trendChartOptions"
        skeletonType="line">
      </app-chart-card>

      <app-chart-card class="span-half"
        title="Cơ cấu Đối tượng (BHYT/VP)"
        icon="fas fa-chart-pie"
        iconClass="icon-info"
        [isLoading]="isLoading"
        [chartOptions]="typeChartOptions"
        skeletonType="pie">
      </app-chart-card>

      <app-chart-card class="span-half"
        title="Phân bổ theo Hình thức"
        icon="fas fa-chart-bar"
        [isLoading]="isLoading"
        iconClass="icon-info"
        [chartOptions]="admissionChartOptions"
        skeletonType="bar">
      </app-chart-card>

      <div class="table-card span-full">
        <h3 class="card-title"><i class="fas fa-table"></i> Dữ liệu chi tiết</h3>
        <div class="table-wrapper">
          <app-reusable-table
            [data]="rawData"
            [columns]="tableColumns"
            [isLoading]="isLoading"
            [showPaginator]="false"
            [pageSize]="10"
            [clientSideSort]="true"
            emptyStateText="Không có dữ liệu cho khoảng thời gian này.">
          </app-reusable-table>
        </div>
      </div>
    </div>

  </div>
</div>