<div class="page-container">
  <div class="page-content">
    
    <app-date-filter
      (filterSubmit)="onDateFilter($event)"
      [isLoading]="isLoading"
      buttonLabel="Lọc dữ liệu"
    ></app-date-filter>

    <div class="widget-section">
      <div class="widget-grid">
        @if (isInitialLoad) { 
          @for (i of [1, 2, 3, 4, 5]; track i) {
            <app-widget-card [title]="'Loading...'" [isLoading]="true"></app-widget-card>
          } 
        } @else { 
          @for (widget of widgetData; track trackByWidget($index, widget)) {
            <app-widget-card
              [icon]="widget.icon"
              [title]="widget.title"
              [value]="widget.value"
              [caption]="widget.caption"
              [accentColor]="widget.accentColor"
            ></app-widget-card>
          } 
        }
      </div>
    </div>

    <div class="dashboard-grid">
      
      <app-chart-card
        class="grid-item span-4"
        title="Biểu Đồ Tiếp Nhận Theo Ngày"
        icon="fas fa-chart-line"
        iconClass="icon-info"
        [isLoading]="isLoading"
        [chartOptions]="trendChartOptions"
        skeletonType="line"
        [theme]="themeService.isDarkTheme() ? 'dark' : 'light'"
      >
      </app-chart-card>

      <app-chart-card
        class="grid-item span-2"
        title="Tỷ Lệ Bệnh Nhân"
        subtitle="(Mới / Cũ)"
        icon="fas fa-user-friends"
        iconClass="icon-danger"
        [isLoading]="isLoading"
        [chartOptions]="patientStatusChartOptions"
        skeletonType="pie"
        [theme]="themeService.isDarkTheme() ? 'dark' : 'light'"
      >
      </app-chart-card>

      <app-chart-card
        class="grid-item span-2"
        title="Đối Tượng"
        subtitle="(BHYT / Viện Phí)"
        icon="fas fa-pie-chart"
        iconClass="icon-warning"
        [isLoading]="isLoading"
        [chartOptions]="typeChartOptions"
        skeletonType="pie"
        [theme]="themeService.isDarkTheme() ? 'dark' : 'light'"
      >
      </app-chart-card>

      <app-table-card
        class="grid-item span-4"
        title="Dữ Liệu Chi Tiết"
        icon="fas fa-table"
        iconClass="icon-success"
        
        [isLoading]="isLoading"
        [data]="rawData"
        [columns]="tableColumns"
        [showPaginator]="true"
        [pageSize]="10"
        [pageSizeOptions]="[5, 10, 25, 50]"
        [clientSideSort]="true"
        emptyStateText="Không có dữ liệu cho khoảng thời gian này."
        
        [enableExport]="true"
        [isExporting]="isExporting"
        (exportClicked)="onExport()"
      >
      </app-table-card>

    </div>
  </div>
</div>