<div class="page-container">
  <div class="page-content">
    <div class="widget-section">
      <div class="widget-grid">
        @if (isLoading && widgetData.length === 0) { 
          @for (i of [1, 2, 3, 4, 5, 6]; track i) {
            <app-widget-card [title]="'Loading'" [isLoading]="true" />
          } 
        } @else { 
          @for (widget of widgetData; track trackByWidgetId($index, widget)) {
            <app-widget-card
              [icon]="widget.icon"
              [title]="widget.title"
              [value]="widget.value"
              [caption]="widget.caption"
              [accentColor]="widget.accentColor"
              [isLoading]="isLoading"
            />
          } 
        }
      </div>
    </div>

    <div class="dashboard-main-content">
      <div
        class="filter-bar-container"
        [class.filter-bar-container--active]="currentFilter"
      >
        <div class="filter-bar">
          @if (visibleFilter) {
          <span>
            Đang lọc theo:
            <strong>{{ visibleFilter.name }}</strong>
          </span>
          <button class="clear-filter-btn" (click)="clearFilter()">
            <i class="fas fa-times"></i> Xóa bộ lọc
          </button>
          }
        </div>
      </div>

      <div class="dashboard-main-grid">
        <app-chart-card
          class="span-2"
          title="Thống Kê Trạng Thái"
          [subtitle]="statusChartSubtext"
          icon="fas fa-pie-chart"
          iconClass="icon-info"
          [isLoading]="isLoading"
          skeletonType="pie"
          [chartOptions]="statusChartOptions"
          (chartClick)="onChartClick('status', $event)"
          [theme]="themeService.isDarkTheme() ? 'dark' : 'light'"
        >
        </app-chart-card>

        <app-chart-card
          class="span-1"
          title="Số Lượng Theo Loại (Top 10)"
          icon="fas fa-tags"
          iconClass="icon-info"
          [isLoading]="isLoading"
          skeletonType="bar"
          [chartOptions]="categoryChartOptions"
          (chartClick)="onChartClick('category', $event)"
          [theme]="themeService.isDarkTheme() ? 'dark' : 'light'"
        >
        </app-chart-card>

        <app-chart-card
          class="span-1"
          [title]="locationChartTitle"
          icon="fas fa-map-marker-alt"
          iconClass="icon-info"
          [isLoading]="isLoading"
          [chartOptions]="locationChartOptions"
          (chartClick)="onChartClick('location', $event)"
          [theme]="themeService.isDarkTheme() ? 'dark' : 'light'"
        >
        </app-chart-card>

        <app-table-card
          class="span-2"
          title="Thiết Bị Cần Chú Ý"
          icon="fas fa-tools"
          iconClass="icon-warning"
          [isLoading]="isLoading"
          [data]="attentionDevices"
          [columns]="attentionTableColumns"
          [showPaginator]="true"
          [pageSize]="10"
          [clientSideSort]="true"
          emptyStateText="Không có thiết bị nào cần bảo trì."
          (rowClick)="navigateToDetail($event)"
          [enableExport]="false"
        >
        </app-table-card>

        <app-chart-card
          class="span-3"
          title="Thiết Bị Mới Theo Tháng"
          icon="fas fa-chart-line"
          iconClass="icon-info"
          [isLoading]="isLoading"
          skeletonType="line"
          [chartOptions]="trendChartOptions"
          [theme]="themeService.isDarkTheme() ? 'dark' : 'light'"
        >
        </app-chart-card>

        <app-table-card
          class="span-3"
          title="Sắp Hết Hạn Bảo hành (30 Ngày Tới)"
          icon="fas fa-calendar-times"
          iconClass="icon-danger"
          [isLoading]="isLoading"
          [data]="expiringDevices"
          [columns]="expiringTableColumns"
          [showPaginator]="false"
          [clientSideSort]="true"
          emptyStateText="Không có thiết bị nào sắp hết hạn."
          (rowClick)="navigateToDetail($event)"
          [enableExport]="false"
        >
        </app-table-card>
      </div>
    </div>
  </div>
</div>