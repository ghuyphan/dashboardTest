<div class="page-container">
  <div class="page-content">

    @if (isLoading && widgetData.length === 0) {
      <div class="widget-section">
        <div class="widget-grid">
          @for (i of [1, 2, 3, 4, 5, 6, 7, 8]; track i) {
            <app-widget-card [isLoading]="true" title="Loading"></app-widget-card>
          }
        </div>
      </div>
    } @else {
      <div class="widget-section">
        <div class="widget-grid">
          @for (widget of widgetData; track trackByWidgetId($index, widget)) {
            <app-widget-card
              [icon]="widget.icon"
              [title]="widget.title"
              [value]="widget.value"
              [caption]="widget.caption"
              [accentColor]="widget.accentColor"
              [isLoading]="isLoading">
            </app-widget-card>
          }
        </div>
      </div>
    }

    <app-chart-card
      title="Tình Hình Sử Dụng Giường Bệnh"
      icon="fas fa-bed-pulse"
      iconClass="icon-info"
      [isLoading]="isLoading"
      [chartOptions]="chartOptions"
      [theme]="themeService.isDarkTheme() ? 'dark' : 'light'">

      <div
        header-actions
        class="refresh-control"
        (click)="loadData()"
        [class.loading]="isLoading"
        [attr.aria-label]="isLoading ? 'Loading data' : 'Refresh data'"
        role="button"
        tabindex="0"
        (keydown.enter)="loadData()"
        (keydown.space)="loadData()">

        <div class="refresh-icon">
          <i class="fas" [ngClass]="{'fa-sync': !isLoading, 'fa-spinner fa-spin': isLoading}"></i>
        </div>
        
        @if (currentDateTime) {
          <span class="refresh-text">
            Cập nhập: {{ currentDateTime }}
          </span>
        }
      </div>

    </app-chart-card>

  </div>
</div>