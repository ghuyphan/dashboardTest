<div class="page-container">
  <div class="page-content">

    <app-date-filter (filterSubmit)="onDateFilter($event)" [isLoading]="isLoading"
      buttonLabel="Lọc dữ liệu"></app-date-filter>

    <div class="widget-section">
      <div class="widget-grid">
        @for (widget of widgetData; track widget.id) {
        <app-widget-card [icon]="widget.icon" [title]="widget.title" [value]="widget.value" [caption]="widget.caption"
          [accentColor]="widget.accentColor" [isLoading]="isLoading" />
        }
      </div>
    </div>

    <div class="dashboard-grid">

      @defer (on immediate) {
      <app-chart-card class="span-4" title="Tổng lượt cấp cứu" icon="fas fa-chart-line" iconClass="icon-info"
        [isLoading]="isLoading" [chartOptions]="trendChartOptions" skeletonType="line"
        [theme]="themeService.isDarkTheme() ? 'dark' : 'light'" emptyText="Chưa có dữ liệu cấp cứu.">
      </app-chart-card>
      } @placeholder {
      <div class="span-4">
        <div class="chart-placeholder"></div>
      </div>
      }

      @defer (on immediate) {
      <app-chart-card class="span-2" title="Lượt chuyển tuyến từ Cấp cứu" icon="fas fa-ambulance"
        iconClass="icon-danger" [isLoading]="isLoading" [chartOptions]="transferChartOptions" skeletonType="bar"
        [theme]="themeService.isDarkTheme() ? 'dark' : 'light'" emptyText="Chưa có dữ liệu chuyển viện.">
      </app-chart-card>
      } @placeholder {
      <div class="span-2">
        <div class="chart-placeholder"></div>
      </div>
      }

      @defer (on immediate) {
      <app-chart-card class="span-2" title="Tỷ lệ chuyển đổi Cấp cứu sang IP (%)" subtitle="(Số lượng / %)"
        icon="fas fa-procedures" iconClass="icon-success" [isLoading]="isLoading" [chartOptions]="admissionChartOptions"
        skeletonType="bar" [theme]="themeService.isDarkTheme() ? 'dark' : 'light'"
        emptyText="Chưa có dữ liệu nhập viện.">
      </app-chart-card>
      } @placeholder {
      <div class="span-2">
        <div class="chart-placeholder"></div>
      </div>
      }

      @defer (on immediate) {
      <app-chart-card class="span-2" title="Tỷ lệ cấp cứu theo Đối tượng" icon="fas fa-pie-chart" iconClass="icon-info"
        [isLoading]="isLoading" [chartOptions]="insuranceChartOptions" skeletonType="pie"
        [theme]="themeService.isDarkTheme() ? 'dark' : 'light'" emptyText="Chưa có dữ liệu BHYT.">
      </app-chart-card>
      } @placeholder {
      <div class="span-2">
        <div class="chart-placeholder"></div>
      </div>
      }

      @defer (on immediate) {
      <app-chart-card class="span-2" title="Kết quả điều trị CC" icon="fas fa-chart-pie" iconClass="icon-success"
        [isLoading]="isLoading" [chartOptions]="outcomeChartOptions" skeletonType="pie"
        [theme]="themeService.isDarkTheme() ? 'dark' : 'light'" emptyText="Chưa có dữ liệu kết quả.">
      </app-chart-card>
      } @placeholder {
      <div class="span-2">
        <div class="chart-placeholder"></div>
      </div>
      }


      <app-table-card class="table-full-row" title="Dữ liệu chi tiết" icon="fas fa-table" iconClass="icon-success"
        [isLoading]="isLoading" [data]="rawData" [columns]="tableColumns" [showPaginator]="true" [pageSize]="5"
        [pageSizeOptions]="[10, 25, 50, 100]" [clientSideSort]="true" emptyStateText="Không tìm thấy dữ liệu."
        [enableExport]="true" [isExporting]="isExporting" (exportClicked)="onExport()">
      </app-table-card>

    </div>
  </div>
</div>