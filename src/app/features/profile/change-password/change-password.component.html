<div class="page-container">
  <div class="password-card">
    <div class="card-header">
      <h2><i class="fas fa-key"></i> Đổi Mật Khẩu</h2>
      <p class="subtitle">Vui lòng nhập thông tin bên dưới để cập nhật mật khẩu của bạn.</p>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-content">
      
      <div class="form-group">
        <label for="OldPassword">Mật khẩu cũ <span class="required">*</span></label>
        <div class="input-wrapper">
          <input 
            [type]="showOld() ? 'text' : 'password'" 
            id="OldPassword" 
            formControlName="OldPassword"
            class="form-control"
            [class.is-invalid]="form.get('OldPassword')?.invalid && form.get('OldPassword')?.touched"
            placeholder="Nhập mật khẩu hiện tại"
          />
          <button type="button" class="toggle-btn" (click)="toggleVisibility('old')" tabindex="-1">
            <i class="fas" [class]="showOld() ? 'fa-eye-slash' : 'fa-eye'"></i>
          </button>
        </div>
        @if (form.get('OldPassword')?.invalid && form.get('OldPassword')?.touched) {
          <div class="error-msg">Vui lòng nhập mật khẩu cũ.</div>
        }
      </div>

      <div class="form-group">
        <label for="NewPassword">Mật khẩu mới <span class="required">*</span></label>
        <div class="input-wrapper">
          <input 
            [type]="showNew() ? 'text' : 'password'" 
            id="NewPassword" 
            formControlName="NewPassword"
            class="form-control"
            [class.is-invalid]="form.get('NewPassword')?.invalid && form.get('NewPassword')?.touched"
            placeholder="Mật khẩu mới (tối thiểu 6 ký tự)"
          />
          <button type="button" class="toggle-btn" (click)="toggleVisibility('new')" tabindex="-1">
            <i class="fas" [class]="showNew() ? 'fa-eye-slash' : 'fa-eye'"></i>
          </button>
        </div>
        @if (form.get('NewPassword')?.hasError('required') && form.get('NewPassword')?.touched) {
          <div class="error-msg">Vui lòng nhập mật khẩu mới.</div>
        }
        @if (form.get('NewPassword')?.hasError('minlength') && form.get('NewPassword')?.touched) {
          <div class="error-msg">Mật khẩu phải có ít nhất 6 ký tự.</div>
        }
      </div>

      <div class="form-group">
        <label for="ConfirmPassword">Xác nhận mật khẩu <span class="required">*</span></label>
        <div class="input-wrapper">
          <input 
            [type]="showConfirm() ? 'text' : 'password'" 
            id="ConfirmPassword" 
            formControlName="ConfirmPassword"
            class="form-control"
            [class.is-invalid]="(form.get('ConfirmPassword')?.touched || form.touched) && form.hasError('mismatch')"
            placeholder="Nhập lại mật khẩu mới"
          />
          <button type="button" class="toggle-btn" (click)="toggleVisibility('confirm')" tabindex="-1">
            <i class="fas" [class]="showConfirm() ? 'fa-eye-slash' : 'fa-eye'"></i>
          </button>
        </div>
        @if (form.hasError('mismatch') && (form.get('ConfirmPassword')?.touched || form.touched)) {
          <div class="error-msg">Mật khẩu xác nhận không khớp.</div>
        }
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="onCancel()" [disabled]="isLoading()">
          <i class="fas fa-arrow-left"></i> Quay lại
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="form.invalid || isLoading()">
          @if (isLoading()) {
            <i class="fas fa-spinner fa-spin"></i> Đang xử lý...
          } @else {
            <i class="fas fa-save"></i> Lưu thay đổi
          }
        </button>
      </div>

    </form>
  </div>
</div>