<div class="chart-card">
  @if (title() || subtitle() || icon()) {
    <div class="card-header">
      <div class="card-title-wrapper">
        <h3 class="card-title">
          @if (icon()) {
            <i [class]="icon()" [ngClass]="iconClass()" aria-hidden="true"></i>
          }
          {{ title() }}
        </h3>
        
        @if (subtitle()) {
          <span class="card-subtitle">{{ subtitle() }}</span>
        }
      </div>
      
      <div class="header-controls">
        <ng-content select="[header-actions]"></ng-content>
      </div>
    </div>
  }

  <div class="card-body">
    @if (isLoading()) {
      <div class="skeleton-overlay" aria-label="Loading chart">
        <div class="sk-legend">
          <div class="sk-legend-item skeleton"></div>
          <div class="sk-legend-item skeleton"></div>
        </div>
        
        @switch (skeletonType()) {
          @case ('pie') {
            <div class="sk-chart-area sk-pie-area">
              <div class="sk-pie skeleton"></div>
            </div>
          }

          @case ('line') {
            <div class="sk-chart-area">
              <div class="sk-y-axis">
                <div class="sk-y-label skeleton"></div>
                <div class="sk-y-label skeleton"></div>
                <div class="sk-y-label skeleton"></div>
                <div class="sk-y-label skeleton"></div>
              </div>
    
              <div class="sk-plot-area line-mode">
                <svg viewBox="0 0 100 50" preserveAspectRatio="none" class="sk-line-svg">
                  <path d="M0,40 Q15,35 25,20 T50,30 T75,10 T100,25" 
                        fill="none" 
                        stroke="var(--gray-200)" 
                        stroke-width="3" 
                        vector-effect="non-scaling-stroke"
                        class="skeleton-stroke" />
                </svg>
                <svg viewBox="0 0 100 50" preserveAspectRatio="none" class="sk-area-svg">
                  <path d="M0,40 Q15,35 25,20 T50,30 T75,10 T100,25 V50 H0 Z" 
                        fill="var(--gray-100)" 
                        style="opacity: 0.5;" />
                </svg>
              </div>
            </div>
          }

          @default {
            <div class="sk-chart-area">
              <div class="sk-y-axis">
                <div class="sk-y-label skeleton"></div>
                <div class="sk-y-label skeleton"></div>
                <div class="sk-y-label skeleton"></div>
                <div class="sk-y-label skeleton"></div>
              </div>
    
              <div class="sk-plot-area">
                <div class="sk-bar skeleton" style="--h: 60%"></div>
                <div class="sk-bar skeleton" style="--h: 40%"></div>
                <div class="sk-bar skeleton" style="--h: 75%"></div>
                <div class="sk-bar skeleton" style="--h: 50%"></div>
                <div class="sk-bar skeleton" style="--h: 85%"></div>
                <div class="sk-bar skeleton" style="--h: 30%"></div>
              </div>
            </div>
          }
        }
      </div>
    }

    <div 
      #chartContainer 
      class="chart-container"
      [class.invisible]="!showChart()"
      role="img" 
      [attr.aria-label]="title() ? 'Chart showing ' + title() : 'Data visualization'">
    </div>
    
    @if (showEmptyState()) {
      <div class="no-data-container">
        <div class="no-data-icon-wrapper">
          <i [class]="emptyIcon()" aria-hidden="true"></i>
        </div>
        <span class="no-data-text">{{ emptyText() }}</span>
      </div>
    }
  </div>
</div>