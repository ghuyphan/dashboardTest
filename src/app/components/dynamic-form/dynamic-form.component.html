<div class="dynamic-form-container">
  <form [formGroup]="dynamicForm" (ngSubmit)="onSave()" novalidate>
    <div class="form-body">
      
      <div *ngIf="formConfig" class="dynamic-form-layout">
        
        <div *ngFor="let row of formConfig.formRows" class="form-row">
          
          <div *ngFor="let control of row.controls"
               class="form-group"
               [ngClass]="control.cssClass"
               [style.flex-grow]="control.layout_flexGrow">

            <label [for]="control.controlName">
              {{ control.label }}
              <span *ngIf="control.validators?.required" class="required-asterisk">*</span>
              </label>

            <div [ngSwitch]="control.controlType">

              <input *ngSwitchCase="'text'"
                     [type]="'text'"
                     [id]="control.controlName"
                     [formControlName]="control.controlName"
                     [placeholder]="control.placeholder || ''"
                     class="form-control"
                     [class.is-invalid]="isInvalid(control.controlName)"
              />

              <select *ngSwitchCase="'dropdown'"
                      [id]="control.controlName"
                      [formControlName]="control.controlName"
                      class="form-control"
                      [class.is-invalid]="isInvalid(control.controlName)">
                
                <option *ngFor="let opt of control.options" [ngValue]="opt.key">
                  {{ opt.value }}
                </option>
              </select>

              <textarea *ngSwitchCase="'textarea'"
                        [id]="control.controlName"
                        [formControlName]="control.controlName"
                        [placeholder]="control.placeholder || ''"
                        class="form-control"
                        rows="3"
                        [class.is-invalid]="isInvalid(control.controlName)">
              </textarea>
              
              <div *ngSwitchCase="'checkbox'" class="checkbox-wrapper">
                 <input type="checkbox"
                        [id]="control.controlName"
                        [formControlName]="control.controlName"
                        class="form-check-input"
                  />
                  </div>

            </div>

            <div *ngIf="isInvalid(control.controlName)" class="invalid-feedback">
              {{ getErrorMessage(control) }}
            </div>

          </div>
        </div>
      </div>
    </div>

    <div class="form-actions">
      <button
        type="button"
        class="btn btn-secondary"
        (click)="onCancel()"
        [disabled]="isLoading"
      >
        Hủy bỏ
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="dynamicForm.invalid || isLoading"
      >
        <span *ngIf="!isLoading">Lưu</span>
        <span *ngIf="isLoading">Đang lưu...</span>
      </button>
    </div>
  </form>
</div>