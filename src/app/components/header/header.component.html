<header class="dashboard-header">
  <!-- LEFT SECTION -->
  <div class="header-left-controls">
    
    <!-- Mobile Toggle: Hidden on Desktop via CSS -->
    <button
      class="header-icon-btn mobile-sidebar-toggle"
      (click)="onMobileToggleClick()"
      aria-label="Toggle sidebar"
    >
      <svg width="20" height="20" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" style="display: block">
        <rect y="10" width="100" height="80" rx="15" ry="15" fill="#1E3A6B" />
        <rect x="10" y="25" width="25" height="10" rx="5" ry="5" fill="#fff" />
        <rect x="10" y="40" width="25" height="10" rx="5" ry="5" fill="#fff" />
        <rect x="10" y="55" width="25" height="10" rx="5" ry="5" fill="#fff" />
        <rect x="42" y="20" width="50" height="60" rx="5" ry="5" fill="#fff" />
      </svg>
    </button>
    
    <button
      *ngIf="showBackButton"
      class="header-icon-btn header-back-btn"
      (click)="onBackClick()"
      aria-label="Go back"
    >
      <i class="fas fa-arrow-left"></i>
    </button>

    <h2 class="header-title">{{ currentScreenName }}</h2>
  </div>

  <!-- CENTER SEARCH (Optional) -->
  <div class="header-search-container" *ngIf="showSearchBar">
    <div class="search-icon-wrapper">
      <i class="fas fa-search search-icon"></i>
    </div>
    <input
      type="text"
      class="header-search-input"
      placeholder="Tìm kiếm..."
      [value]="searchTerm"
      (input)="onSearchChange($event)"
      aria-label="Search"
    />
    <button
      *ngIf="searchTerm"
      type="button"
      class="search-clear-btn"
      (click)="onClearSearch()"
      aria-label="Clear search"
    >
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- RIGHT SECTION -->
  <div class="header-right-controls">
    <div class="user-menu" *ngIf="currentUser">
      
      <!-- Trigger Button -->
      <button class="user-menu-toggle" [matMenuTriggerFor]="userMenu">
        <div class="header-avatar-initials">{{ userInitials }}</div>
        <!-- Chevron Icon -->
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="chevron-icon">
          <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
        </svg>
      </button>

      <!-- Dropdown Menu -->
      <mat-menu #userMenu="matMenu" class="header-user-menu-panel" xPosition="before">
        
        <!-- Profile Card -->
        <div class="menu-section-wrapper" (click)="$event.stopPropagation()">
          <div class="dropdown-profile-header">
            <div class="dropdown-avatar-initials">{{ userInitials }}</div>
            <div class="dropdown-profile-text">
              <span class="username">{{ currentUser.fullName }}</span>
              <span class="user-role">{{ rolesDisplay }}</span>
            </div>
          </div>
        </div>

        <!-- Menu Actions -->
        <div class="menu-items-wrapper">
          <button mat-menu-item (click)="onSettingsClick()" class="custom-menu-item">
            <div class="menu-icon-bg"><i class="fas fa-gear"></i></div>
            <span>Cài đặt</span>
          </button>

          <button mat-menu-item (click)="onSupportClick()" class="custom-menu-item">
            <div class="menu-icon-bg"><i class="fas fa-question-circle"></i></div>
            <span>Hỗ trợ</span>
          </button>

          <button mat-menu-item (click)="onLogoutClick()" class="custom-menu-item logout-item">
            <div class="menu-icon-bg"><i class="fas fa-sign-out-alt"></i></div>
            <span>Đăng xuất</span>
          </button>
        </div>

      </mat-menu>
    </div>
  </div>
</header>