<div class="page-container">
  <div class="page-content">
    <div class="widget-section" *ngIf="isLoading && widgetData.length === 0; else widgetsLoaded">
      <div class="widget-grid">
        <div class="widget-skeleton" *ngFor="let i of [1,2,3,4,5,6,7]"></div>
      </div>
    </div>
    
    <ng-template #widgetsLoaded>
      <div class="widget-section">
        <div class="widget-grid">
          <app-widget-card 
            *ngFor="let widget of widgetData; trackBy: trackByWidgetId"
            [icon]="widget.icon"
            [title]="widget.title"
            [value]="widget.value"
            [caption]="widget.caption"
            [accentColor]="widget.accentColor">
          </app-widget-card>
        </div>
      </div>
    </ng-template>

    <div class="chart-wrapper">
      <div class="chart-header-row">
        <h2 class="chart-title">
          Tình Hình Sử Dụng Giường Bệnh Toàn Viện
          <span class="chart-subtitle">Overall Hospital Bed Occupancy Status</span>
        </h2>

        <div 
          class="refresh-control" 
          (click)="loadData()" 
          [class.loading]="isLoading"
          [attr.aria-label]="isLoading ? 'Loading data' : 'Refresh data'"
          role="button"
          tabindex="0"
          (keydown.enter)="loadData()"
          (keydown.space)="loadData()">
          <div class="refresh-icon">
            <i class="fas" [ngClass]="{'fa-sync': !isLoading, 'fa-spinner fa-spin': isLoading}"></i>
          </div>
          <span class="refresh-text" *ngIf="currentDateTime">
            Last Updated: {{ currentDateTime }}
          </span>
        </div>
      </div>
      
      <div 
        #chartContainer 
        class="chart-container-inner"
        [attr.aria-busy]="isLoading"
        role="img"
        [attr.aria-label]="isChartInitialized ? 'Bed usage chart' : 'Loading chart'">
      </div>
    </div>
  </div>
</div>