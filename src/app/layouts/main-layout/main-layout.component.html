<div class="dashboard-container">
  <app-sidebar
    [navItems]="navItems()"
    [isOpen]="sidebarOpen()"
    (toggleSidebar)="toggleSidebar()"
    (closeSidebar)="closeSidebar()"
  ></app-sidebar>

  <div
    class="sidebar-backdrop"
    [class.show]="sidebarOpen()"
    (click)="toggleSidebar()"
  ></div>

  <div class="main-panel" [ngClass]="{ 'collapsed': !sidebarOpen() }">
    
    <app-header
      [currentUser]="currentUser()"
      [userInitials]="userInitials()"
      [rolesDisplay]="rolesDisplay()"
      [currentScreenName]="screenTitle()"
      [showSearchBar]="searchVisible()" 
      [showBackButton]="backButtonVisible()" 
      (sidebarToggled)="toggleSidebar()"
      (logoutClicked)="logout()"
      (backClicked)="onBackClicked()" 
    ></app-header>

    <main class="dashboard-content">
      @if (contentLoaded()) {
        <div class="content-fade-wrapper">
          <router-outlet></router-outlet>
        </div>
      } @else {
        <div class="app-loading-container">
          <div class="app-loading-spinner"></div>
          <p>Đang tải hệ thống...</p> 
        </div>
      }
    </main>
    
    <app-action-footer></app-action-footer>
  </div>
</div>